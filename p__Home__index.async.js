"use strict";(self.webpackChunkdbml_editor=self.webpackChunkdbml_editor||[]).push([[3371],{72700:function(Te,M,s){s.r(M),s.d(M,{default:function(){return ue}});var U=s(48305),d=s.n(U),y=s(87255),$=s(27975),N=s(34078),O=s(44091),Z=s(10773),E=s(3048),Y=s(21375),T=s(47475),G=s(48831),o=s(93236),K=s(30563),F=`Table users {
  id integer
  username varchar
  role varchar
  created_at timestamp

  Note: 'User Table'
}

Table posts {
  id integer [primary key]
  title varchar
  body text [note: 'Content of the post']
  user_id integer
  status post_status
  created_at timestamp
}

Enum post_status {
  draft
  published
  private [note: 'visible via URL only']
}

Ref: posts.user_id > users.id // many-to-one
`;function W(t,n,e){var l=t.name;return t.pk&&(l+=" \u{1F511}"),t.not_null&&(l+=" \u{1F6AB}"),{id:"".concat(n,"-").concat(e,"-").concat(t.name),group:"list",attrs:{portNameLabel:{text:l},portTypeLabel:{text:t.type.type_name||"unknown"}}}}function X(t,n,e){return{id:"".concat(n,"-").concat(e,"-note"),group:"note",attrs:{note:{text:t}}}}function k(t,n){for(var e=[],l=0;l<t.fields.length;l++){var c=t.fields[l],u=W(c,n,t.name);e.push(u)}if(t.note){var m=X(t.note,n,t.name);e.push(m)}return{id:"".concat(n,"-").concat(t.name),shape:"er-rect",label:t.name,width:150,height:24,ports:e}}function q(t){if(t.endpoints.length!==2)return console.warn("ref.endpoints.length !== 2"),null;var n=t.endpoints[0],e=t.endpoints[1],l=n.fieldNames[0],c=e.fieldNames[0],u=n.schemaName||"public",m=e.schemaName||"public";return{id:"",shape:"edge",router:{name:"er",args:{offset:16,min:4,direction:"H"}},source:{cell:"".concat(u,"-").concat(n.tableName),port:"".concat(u,"-").concat(n.tableName,"-").concat(l)},target:{cell:"".concat(m,"-").concat(e.tableName),port:"".concat(m,"-").concat(e.tableName,"-").concat(c)},labels:[{attrs:{label:{text:n.relation,fontFamily:"monospace"}},position:.2},{attrs:{label:{text:e.relation,fontFamily:"monospace"}},position:.8}]}}function _(t){for(var n=[],e=0;e<t.schemas.length;e++)for(var l=t.schemas[e],c=0;c<t.schemas[e].tables.length;c++){var u=t.schemas[e].tables[c],m=k(u,l.name);n.push(m)}for(var p=[],v=0;v<t.schemas.length;v++)for(var f=t.schemas[v],h=0;h<f.refs.length;h++){var S=t.schemas[v].refs[h],g=q(S);g!==null&&(console.log(g),p.push(g))}return{nodes:n,edges:p}}var ee=_,te=s(21409),ae=s(20240),ne=s(66508),a=s(62086),se=function(n){var e=(0,o.useRef)(null),l=(0,o.useState)({}),c=d()(l,2),u=c[0],m=c[1],p=new te.Vq({type:"dagre",rankdir:"LR",align:"UL",ranksep:80,nodesep:60,controlPoints:!0}),v=p;return(0,o.useEffect)(function(){if(e.current){var f=new ae.kJ({container:e.current,connecting:{anchor:{name:"midSide",args:{direction:"H"}},allowBlank:!1,allowEdge:!1,allowNode:!1},background:{color:"#F2F7FA"},interacting:{nodeMovable:!0,edgeMovable:!1,edgeLabelMovable:!1,arrowheadMovable:!1,vertexMovable:!1,vertexAddable:!1,vertexDeletable:!1},panning:!0,mousewheel:!1});f.use(new ne.H({enabled:!0})),f.fromJSON(u),f.centerContent()}},[u]),(0,o.useEffect)(function(){var f=ee(n.database);m(v.layout(f))},[n.database]),(0,a.jsx)("div",{className:"react-shape-app",children:(0,a.jsx)("div",{className:"app-content",ref:e})})},re=se;function b(t){var n=t.diags.map(function(e){return"".concat(e.location.start.line,":").concat(e.location.start.column," ").concat(e.message)}).join(`
`);return n}var oe=s(27867),le=s(9321),ie=s(29922),I=s(68409),ce=2e3,ue=function(){var t=$.ZP.useMessage(),n=d()(t,2),e=n[0],l=n[1],c=new y._b,u=c.parse(F,"dbmlv2"),m=(0,o.useState)(F),p=d()(m,2),v=p[0],f=p[1],h=(0,o.useState)(u),S=d()(h,2),g=S[0],D=S[1],de=(0,o.useState)(""),P=d()(de,2),ve=P[0],me=P[1],fe=(0,o.useState)("mysql"),Q=d()(fe,2),R=Q[0],pe=Q[1],he=(0,o.useState)(!1),A=d()(he,2),ge=A[0],C=A[1],xe=(0,o.useState)(!1),B=d()(xe,2),H=B[0],j=B[1],Se=(0,o.useState)("mysql"),V=d()(Se,2),L=V[0],ye=V[1],be=(0,o.useState)(""),w=d()(be,2),Ce=w[0],je=w[1],Le=(0,o.useState)(0),J=d()(Le,2),z=J[0],Me=J[1],Ne=function(){D(u)},Oe=function(r){f(r)},Ze=(0,G.Z)(Oe,ce),Ee=function(){try{var r=y.Zl.import(ve,R);f(r),C(!1)}catch(x){if(x)e.error(b(x));else if(x instanceof Error){e.error("".concat(x.message));return}else throw x}};return(0,o.useEffect)(function(){try{var i=c.parse(v,"dbmlv2");D(i)}catch(r){if(r)e.error(b(r));else if(r instanceof Error)e.error("".concat(r.message));else throw r}},[v]),(0,o.useEffect)(function(){if(H)try{var i=y.OY.export(v,L);je(i)}catch(r){if(r)e.error(b(r));else if(r instanceof Error)e.error("".concat(r.message));else throw r}},[L,z]),(0,a.jsxs)(a.Fragment,{children:[l,(0,a.jsx)(N.Z,{tooltip:(0,a.jsx)("div",{children:"Import SQL"}),icon:(0,a.jsx)(oe.Z,{}),style:{left:24},onClick:function(){C(!0)}}),(0,a.jsx)(N.Z,{tooltip:(0,a.jsx)("div",{children:"Export SQL"}),icon:(0,a.jsx)(le.Z,{}),style:{left:72},onClick:function(){Me(z+1),j(!0)}}),(0,a.jsx)(O.Z,{title:"Import SQL",open:ge,onOk:Ee,onCancel:function(){C(!1)},children:(0,a.jsxs)(Z.Z,{direction:"vertical",size:"middle",style:{display:"flex"},children:[(0,a.jsx)(E.Z,{defaultValue:R,style:{width:120},onChange:function(r){return pe(r)},options:[{value:"mysql",label:"MySQL"},{value:"postgres",label:"Postgres"},{value:"postgresLegacy",label:"Postgres Legacy"},{value:"dbml",label:"DBML"},{value:"mssql",label:"MSSQL"},{value:"json",label:"JSON"}]}),(0,a.jsx)(I.Z,{rows:24,placeholder:"Import your schema",onChange:function(r){return me(r.target.value)}})]})}),(0,a.jsx)(O.Z,{title:"Export SQL",open:H,onOk:function(){j(!1)},onCancel:function(){j(!1)},children:(0,a.jsxs)(Z.Z,{direction:"vertical",size:"middle",style:{display:"flex"},children:[(0,a.jsx)(E.Z,{defaultValue:L,style:{width:120},onChange:function(r){return ye(r)},options:[{value:"mysql",label:"MySQL"},{value:"postgres",label:"Postgres"},{value:"dbml",label:"DBML"},{value:"mssql",label:"MSSQL"},{value:"oracle",label:"Oracle"},{value:"json",label:"JSON"}]}),(0,a.jsx)(I.Z,{rows:24,value:Ce,readOnly:!0})]})}),(0,a.jsx)(ie._z,{ghost:!0,header:{title:""},children:(0,a.jsxs)(Y.Z,{gutter:[8,8],children:[(0,a.jsx)(T.Z,{xxl:12,xl:12,lg:12,md:24,sm:24,xs:24,children:(0,a.jsx)("div",{className:"editor",children:(0,a.jsx)(K.ZP,{width:"100%",language:"dbml",theme:"vs-dark",value:v,options:{selectOnLineNumbers:!0,minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1},onChange:Ze,editorDidMount:Ne})})}),(0,a.jsx)(T.Z,{xxl:12,xl:12,lg:12,md:24,sm:24,xs:24,children:(0,a.jsx)(re,{database:g})})]})})]})}}}]);
