"use strict";(self.webpackChunkdbml_editor=self.webpackChunkdbml_editor||[]).push([[3371],{58827:function(Te,N,n){n.r(N),n.d(N,{default:function(){return ue}});var $=n(48305),m=n.n($),b=n(87255),Y=n(27975),O=n(34078),Z=n(44091),E=n(10773),T=n(3048),G=n(21375),F=n(47475),K=n(48831),o=n(93236),W=n(30563),I=`Table users {
  id integer
  username varchar
  role varchar
  created_at timestamp

  Note: 'User Table'
}

Table posts {
  id integer [primary key]
  title varchar
  body text [note: 'Content of the post']
  user_id integer
  status post_status
  created_at timestamp
}

Enum post_status {
  draft
  published
  private [note: 'visible via URL only']
}

Ref: posts.user_id > users.id // many-to-one
`;function X(e,s,t){var r=e.name;return e.pk&&(r+=" \u{1F511}"),e.not_null&&(r+=" \u{1F6AB}"),{id:"".concat(s,"-").concat(t,"-").concat(e.name),group:"list",attrs:{portNameLabel:{text:r},portTypeLabel:{text:e.type.type_name||"unknown"}}}}function k(e,s,t){return{id:"".concat(s,"-").concat(t,"-note"),group:"note",attrs:{note:{text:e}}}}function q(e,s){for(var t=[],r=0;r<e.fields.length;r++){var c=e.fields[r],v=X(c,s,e.name);t.push(v)}if(e.note){var p=k(e.note,s,e.name);t.push(p)}return{id:"".concat(s,"-").concat(e.name),shape:"er-rect",label:e.name,width:150,height:24,ports:t}}function _(e){if(e.endpoints.length!==2)return console.warn("ref.endpoints.length !== 2"),null;var s=e.endpoints[0],t=e.endpoints[1],r=s.fieldNames[0],c=t.fieldNames[0],v=s.schemaName||"public",p=t.schemaName||"public";return{id:"",shape:"edge",router:{name:"er",args:{offset:16,min:4,direction:"H"}},source:{cell:"".concat(v,"-").concat(s.tableName),port:"".concat(v,"-").concat(s.tableName,"-").concat(r)},target:{cell:"".concat(p,"-").concat(t.tableName),port:"".concat(p,"-").concat(t.tableName,"-").concat(c)},labels:[{attrs:{label:{text:s.relation,fontFamily:"monospace"}},position:.2},{attrs:{label:{text:t.relation,fontFamily:"monospace"}},position:.8}]}}function ee(e){for(var s=[],t=0;t<e.schemas.length;t++)for(var r=e.schemas[t],c=0;c<e.schemas[t].tables.length;c++){var v=e.schemas[t].tables[c],p=q(v,r.name);s.push(p)}for(var h=[],f=0;f<e.schemas.length;f++)for(var g=e.schemas[f],x=0;x<g.refs.length;x++){var y=e.schemas[f].refs[x],S=_(y);S!==null&&(console.log(S),h.push(S))}return{nodes:s,edges:h}}var te=ee,ae=n(21409),ne=n(20240),se=n(66508),a=n(62086),oe=function(s){var t=(0,o.useRef)(null),r=(0,o.useState)({}),c=m()(r,2),v=c[0],p=c[1],h=new ae.Vq({type:"dagre",rankdir:"LR",align:"UL",ranksep:80,nodesep:60,controlPoints:!0}),f=h;return(0,o.useEffect)(function(){if(t.current){var g=new ne.kJ({container:t.current,connecting:{anchor:{name:"midSide",args:{direction:"H"}},allowBlank:!1,allowEdge:!1,allowNode:!1},background:{color:"#F2F7FA"},interacting:{nodeMovable:!0,edgeMovable:!1,edgeLabelMovable:!1,arrowheadMovable:!1,vertexMovable:!1,vertexAddable:!1,vertexDeletable:!1},panning:!0,mousewheel:!1});g.use(new se.H({enabled:!0})),g.fromJSON(v),g.centerContent()}},[v]),(0,o.useEffect)(function(){var g=te(s.database);p(f.layout(g))},[s.database]),(0,a.jsx)("div",{className:"react-shape-app",children:(0,a.jsx)("div",{className:"app-content",ref:t})})},re=oe,le=n(27867),ce=n(9321),ie=n(29922),D=n(68409),ue=function(){var e=Y.ZP.useMessage(),s=m()(e,2),t=s[0],r=s[1],c=new b._b,v=c.parse(I,"dbmlv2"),p=(0,o.useState)(I),h=m()(p,2),f=h[0],g=h[1],x=(0,o.useState)(v),y=m()(x,2),S=y[0],P=y[1],de=(0,o.useState)(""),Q=m()(de,2),ve=Q[0],me=Q[1],fe=(0,o.useState)("mysql"),R=m()(fe,2),A=R[0],pe=R[1],ge=(0,o.useState)(!1),H=m()(ge,2),he=H[0],j=H[1],xe=(0,o.useState)(!1),V=m()(xe,2),w=V[0],C=V[1],Se=(0,o.useState)("mysql"),B=m()(Se,2),L=B[0],ye=B[1],be=(0,o.useState)(""),J=m()(be,2),je=J[0],Ce=J[1],Le=(0,o.useState)(0),z=m()(Le,2),U=z[0],Me=z[1],Ne=function(){P(v)};(0,o.useEffect)(function(){try{var l=c.parse(f,"dbmlv2");P(l)}catch(u){if(u){var i=u.diags.map(function(d){return"".concat(d.location.start.line,":").concat(d.location.start.column," ").concat(d.message)}).join(`
`);t.error(i)}else if(u instanceof Error)t.error("".concat(u.message));else throw u}},[f]);var Oe=function(i){g(i)},Ze=(0,K.Z)(Oe,500),Ee=function(){try{var i=b.Zl.import(ve,A);g(i),j(!1)}catch(d){if(d){var u=d.diags.map(function(M){return"".concat(M.location.start.line,":").concat(M.location.start.column," ").concat(M.message)}).join(`
`);t.error(u)}else if(d instanceof Error){t.error("".concat(d.message));return}else throw d}};return(0,o.useEffect)(function(){if(w)try{var l=b.OY.export(f,L);Ce(l)}catch(u){if(u){var i=u.diags.map(function(d){return"".concat(d.location.start.line,":").concat(d.location.start.column," ").concat(d.message)}).join(`
`);t.error(i)}else if(u instanceof Error)t.error("".concat(u.message));else throw u}},[L,U]),(0,a.jsxs)(a.Fragment,{children:[r,(0,a.jsx)(O.Z,{tooltip:(0,a.jsx)("div",{children:"Import SQL"}),icon:(0,a.jsx)(le.Z,{}),style:{left:24},onClick:function(){j(!0)}}),(0,a.jsx)(O.Z,{tooltip:(0,a.jsx)("div",{children:"Export SQL"}),icon:(0,a.jsx)(ce.Z,{}),style:{left:72},onClick:function(){Me(U+1),C(!0)}}),(0,a.jsx)(Z.Z,{title:"Import SQL",open:he,onOk:Ee,onCancel:function(){j(!1)},children:(0,a.jsxs)(E.Z,{direction:"vertical",size:"middle",style:{display:"flex"},children:[(0,a.jsx)(T.Z,{defaultValue:A,style:{width:120},onChange:function(i){return pe(i)},options:[{value:"mysql",label:"MySQL"},{value:"postgres",label:"Postgres"},{value:"postgresLegacy",label:"Postgres Legacy"},{value:"dbml",label:"DBML"},{value:"mssql",label:"MSSQL"},{value:"json",label:"JSON"}]}),(0,a.jsx)(D.Z,{rows:24,placeholder:"Import your schema",onChange:function(i){return me(i.target.value)}})]})}),(0,a.jsx)(Z.Z,{title:"Export SQL",open:w,onOk:function(){C(!1)},onCancel:function(){C(!1)},children:(0,a.jsxs)(E.Z,{direction:"vertical",size:"middle",style:{display:"flex"},children:[(0,a.jsx)(T.Z,{defaultValue:L,style:{width:120},onChange:function(i){return ye(i)},options:[{value:"mysql",label:"MySQL"},{value:"postgres",label:"Postgres"},{value:"dbml",label:"DBML"},{value:"mssql",label:"MSSQL"},{value:"oracle",label:"Oracle"},{value:"json",label:"JSON"}]}),(0,a.jsx)(D.Z,{rows:24,value:je,readOnly:!0})]})}),(0,a.jsx)(ie._z,{ghost:!0,header:{title:""},children:(0,a.jsxs)(G.Z,{gutter:[8,8],children:[(0,a.jsx)(F.Z,{xxl:12,xl:12,lg:12,md:24,sm:24,xs:24,children:(0,a.jsx)("div",{className:"editor",children:(0,a.jsx)(W.ZP,{width:"100%",language:"dbml",theme:"vs-dark",value:f,options:{selectOnLineNumbers:!0,minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1},onChange:Ze,editorDidMount:Ne})})}),(0,a.jsx)(F.Z,{xxl:12,xl:12,lg:12,md:24,sm:24,xs:24,children:(0,a.jsx)(re,{database:S})})]})})]})}}}]);
